'use strict';var Eta={TAB:0,Ek:1,Bo:2},Y$=function(a){Bb("MediaRouter.WebRtc.Start.Success",a,Eta)};var Z$=function(a,c){wj.call(this,c);this.C=a;this.h=new Cb;this.b=Rv(c.id);this.w=new Cb;this.D=!1;this.m=null;this.s=!1;this.o=this.j=null;Fta(this);Gta(this);this.b.sendMessage(new Cj("GET_TURN_CREDENTIALS"))};q(Z$,wj);
Z$.prototype.start=function(a){var c=this;return this.h.b.then(function(b){if(b.b)return Promise.reject(new Ai("Mirroring already started"));if(c.m)return Promise.reject(new Ai("Session permanently stopped"));c.j=new rb("MediaRouter.WebRtc.Session.Launch");b.ga.addStream(a);b.start();return c.w.b})};
Z$.prototype.stop=function(){var a=this;this.w.reject(new Ai("Session stop requested."));this.o&&(this.o.end(),this.o=null);if(this.m)return this.m;this.s=this.D=!1;this.j=null;return this.m=this.h.b.then(function(c){c.stop()}).then(function(){return a.b.lb()}).catch(function(c){a.b.lb();throw c;})};
var Fta=function(a){a.b.onMessage=function(c){if(!c.type)throw Error("Message has no type.");switch(c.type){case "TURN_CREDENTIALS":a.h.resolve(new Hj(a.f.id,c.data.credentials));break;case "ANSWER":a.h.b.then(function(b){Pj(b,c.data)});break;case "KNOCK_ANSWER":a.s=!0;a.h.b.then(function(b){Pj(b,c.data)});break;case "STOP":a.w.reject(new Ai("Stop signal received"));a.stop();break;default:throw new Ai("Unknown message type: "+c.type);}}},Gta=function(a){a.h.b.then(function(c){Lj(c,function(b){a.b.sendMessage(new Cj("OFFER",
new Ej(b,a.C,Fj)))});Mj(c,function(b){b=Dj(b);a.b.sendMessage(b)});Ij(c,function(){a.D=!0;a.b.sendMessage(new Cj("SESSION_START_SUCCESS"));!a.s&&a.j&&a.j.end();a.j=null;a.o=new xb("MediaRouter.WebRtc.Session.Length");a.w.resolve(a)});Kj(c,function(){a.b.sendMessage(new Cj("SESSION_END"))});Jj(c,function(b){a.D||a.w.reject(b);a.b.sendMessage(new Cj("SESSION_FAILURE"))})})};var $$=function(){lj.call(this,"webrtc")};q($$,lj);h=$$.prototype;h.xh=function(a,c){return new Z$(a,c)};h.eh=function(){Y$(0)};h.ah=function(){Y$(1)};h.Yh=function(){Y$(2)};h.bh=function(){Ab("MediaRouter.WebRtc.Session.End")};h.Zf=function(a){Bb("MediaRouter.WebRtc.Start.Failure",a,zi)};h.dh=function(){Ab("MediaRouter.WebRtc.Stream.End")};var Hta=new $$;bj("mr.mirror.webrtc.WebRtcService",Hta);
